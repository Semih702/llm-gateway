suite: proxy secret strategy
templates:
  - proxy-secret.yaml
tests:
  - it: should NOT render secret when no api key is provided
    asserts:
      - hasDocuments:
          count: 0

  - it: should render secret when proxy.openaiApiKey is set
    set:
      proxy.openaiApiKey: "dummy-key"
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Secret
      - isNotNullOrEmpty:
          path: stringData
      - equal:
          path: stringData.UPSTREAM_OPENAI_API_KEY
          value: dummy-key

  - it: should NOT render secret when existingSecretName is set
    set:
      proxy.existingSecretName: "external-secret"
    asserts:
      - hasDocuments:
          count: 0

  - it: should render secret when proxy.openaiApiKey is set
    set:
      proxy.openaiApiKey: "dummy-key"
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Secret
      - equal:
          path: stringData.UPSTREAM_OPENAI_API_KEY
          value: "dummy-key"
